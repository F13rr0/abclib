import("stdfaust.lib");

//--------------------------------------------------------------------------------------//
//HOA ENCODER//
//--------------------------------------------------------------------------------------//

//--------------------------------------------------------------------------------------//
//CONTROL PARAMETERS FOR THE ENCODER
//--------------------------------------------------------------------------------------//
rotfreq = hslider("v:encoder/rotationspeed [unit:s-1]", 0, -1000, 1000, 0.001);
rotphase = hslider("v:encoder/defaultangle [unit:deg]", 0, -360, 360, 0.01) / 360;

//--------------------------------------------------------------------------------------//
//PHASOR WITH PHASE FUNCTION
//--------------------------------------------------------------------------------------//
phasorWithPhase(f, p) = (1-vn) * x + vn * p
with {
		vn = (f == 0);//to manage the case where frequency is zero//
		x = (os.phasor(1, f), p, 1) : (+, _) : fmod;
};

//--------------------------------------------------------------------------------------//
//PHASOR WITH PHASE TO RADIAN ANGLE CONVERSION
//--------------------------------------------------------------------------------------//
phasedAngle(f, p) = phasorWithPhase(f, p) * 2 * ma.PI;

//--------------------------------------------------------------------------------------//
//SELECTING AN ENCODER FROM HO FAUST LIBRARY
//--------------------------------------------------------------------------------------//
myEncoder(sig, angle) = ho.encoder(3, sig, angle);//here at order 3, that can be modified//

//--------------------------------------------------------------------------------------//
//SENDING THE PHASED ANGLE FUNCTION TO THE ENCODER
//--------------------------------------------------------------------------------------//
freqPhaseEncoder(f, p) = (_, phasedAngle(f, p)) : myEncoder;

//--------------------------------------------------------------------------------------//
//PROCESS FUNCTION
//--------------------------------------------------------------------------------------//
process = freqPhaseEncoder(rotfreq, rotphase);