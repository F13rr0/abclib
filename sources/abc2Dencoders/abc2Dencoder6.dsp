import("stdfaust.lib");

//--------------------------------------------------------------------------------------//
//CONTROL PARAMETERS FOR THE ENCODER
//--------------------------------------------------------------------------------------//
rotfreq = hslider("rotfreq", 0, -1000, 1000, 0.001);
rotphase = hslider("rotphase", 0, 0, 1, 0.01);

//--------------------------------------------------------------------------------------//
//PHASOR WITH PHASE FUNCTION
//--------------------------------------------------------------------------------------//
phasorWithPhase(f, p) = (1-vn) * x + vn * p
with {
		vn = (f == 0);//to manage the case where frequency is zero//
		x = (os.phasor(1, f), p, 1) : (+, _) : fmod;
};

//--------------------------------------------------------------------------------------//
//PHASOR WITH PHASE TO RADIAN ANGLE CONVERSION
//--------------------------------------------------------------------------------------//
phasedAngle(f, p) = phasorWithPhase(f, p) * 2 * ma.PI;

//--------------------------------------------------------------------------------------//
//SELECTING AN ENCODER FROM HO FAUST LIBRARY
//--------------------------------------------------------------------------------------//
myEncoder(sig, angle) = ho.encoder(6, sig, angle);//here at order 6, that can be modified//

//--------------------------------------------------------------------------------------//
//SENDING THE PHASED ANGLE FUNCTION TO THE ENCODER
//--------------------------------------------------------------------------------------//
freqPhaseEncoder(f, p) = (_, phasedAngle(f, p)) : myEncoder;

//--------------------------------------------------------------------------------------//
//PROCESS FUNCTION
//--------------------------------------------------------------------------------------//
process = freqPhaseEncoder(rotfreq, rotphase);